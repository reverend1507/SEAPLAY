<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeePlay - Premium Casino Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #00b0ff;
            --accent: #ff4081;
            --dark: #0d1b2a;
            --light: #f5f5f5;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #9e9e9e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--dark);
            color: var(--light);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            background-color: var(--dark);
            min-height: 100vh;
            position: relative;
            padding-bottom: 70px;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 28px;
        }
        
        .time-display {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .winning-users {
            margin-top: 10px;
            font-size: 12px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .winning-user {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Main Content */
        .main-content {
            padding: 15px;
        }
        
        /* Balance Card */
        .balance-card {
            background: linear-gradient(135deg, var(--primary), #3949ab);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .balance-title {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .balance-amount {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .balance-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 14px;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-tab.active {
            background-color: var(--secondary);
            color: var(--dark);
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0 15px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .view-all {
            font-size: 14px;
            color: var(--secondary);
        }
        
        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .game-card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        .game-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--secondary);
        }
        
        .game-name {
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Promo Banner */
        .promo-banner {
            background: linear-gradient(135deg, var(--accent), #ff79a6);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .promo-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .promo-subtitle {
            font-size: 14px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .promo-button {
            background-color: var(--light);
            color: var(--dark);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .promo-button:hover {
            transform: scale(1.05);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(13, 27, 42, 0.95);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            max-width: 480px;
            margin: 0 auto;
        }
        
        .nav-item {
            text-align: center;
            color: var(--gray);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .nav-item.active {
            color: var(--secondary);
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        /* Auth Screens */
        .auth-screen {
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .auth-logo {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-form {
            width: 100%;
            max-width: 350px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--light);
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .auth-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .auth-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .auth-link a {
            color: var(--secondary);
            text-decoration: none;
        }
        
        /* Game Screens */
        .game-screen {
            padding: 15px;
            min-height: 100vh;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .game-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .game-balance {
            font-size: 18px;
            font-weight: bold;
        }
        
        .game-area {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .bet-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .bet-amount {
            font-size: 18px;
            font-weight: bold;
        }
        
        .bet-button {
            background-color: var(--secondary);
            color: var(--dark);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .bet-button:hover {
            transform: scale(1.05);
        }
        
        .bet-button:disabled {
            background-color: var(--gray);
            cursor: not-allowed;
        }
        
        /* Mines Specific */
        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .mine-cell {
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mine-cell.revealed {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .mine-cell.mine {
            background-color: var(--danger);
        }
        
        .mine-cell.gem {
            background-color: var(--success);
        }
        
        .mines-settings {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .mines-setting {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .mines-setting-label {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .mines-setting-value {
            font-size: 16px;
            font-weight: bold;
        }
        
        .mines-setting-controls {
            display: flex;
            gap: 10px;
        }
        
        .mines-control-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--light);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .mines-multiplier-display {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .mines-cashout-amount {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        /* Admin Panel */
        .admin-panel {
            padding: 15px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .admin-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .admin-stat {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .admin-stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .admin-stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .admin-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .admin-action {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 12px;
            color: var(--light);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .admin-action:hover {
            background-color: var(--secondary);
            color: var(--dark);
        }
        
        .users-list {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: bold;
        }
        
        .user-email {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .user-balance {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .user-actions {
            display: flex;
            gap: 5px;
        }
        
        .user-action {
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            padding: 5px;
        }
        
        /* Profile Page */
        .profile-section {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .profile-email {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .profile-stat {
            text-align: center;
        }
        
        .profile-stat-value {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .profile-stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Referral Section */
        .referral-section {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .referral-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .referral-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Transaction History */
        .transaction-section {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .transaction-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .transaction-type {
            font-weight: bold;
        }
        
        .transaction-amount.positive {
            color: var(--success);
        }
        
        .transaction-amount.negative {
            color: var(--danger);
        }
        
        /* Inbox Section */
        .inbox-section {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .message-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .message-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .message-sender {
            font-weight: bold;
        }
        
        .message-time {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .message-content {
            font-size: 14px;
        }
        
        /* Hidden class for toggling screens */
        .hidden {
            display: none;
        }
        
        /* Logout Button */
        .logout-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Back Button */
        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            font-size: 16px;
        }
        
        /* P2P Section */
        .p2p-section {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .p2p-offer {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .p2p-offer-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .p2p-seller {
            font-weight: bold;
        }
        
        .p2p-rating {
            color: var(--warning);
        }
        
        .p2p-offer-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .p2p-phone {
            color: var(--secondary);
        }
        
        /* Chart Container */
        .chart-container {
            width: 100%;
            height: 200px;
            margin-top: 15px;
        }
        
        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="auth-screen">
        <div class="auth-logo">
            <i class="fas fa-water"></i> SeePlay
        </div>
        <div class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
            </div>
            <button id="loginButton" class="auth-button">
                <span id="loginButtonText">Login</span>
                <span id="loginSpinner" class="loading hidden"></span>
            </button>
            <div class="auth-link">
                Don't have an account? <a href="#" id="showRegister">Register</a>
            </div>
            <div class="auth-link">
                <a href="#" id="showAdminLogin">Login as Lord</a>
            </div>
        </div>
    </div>
    
    <!-- Register Screen -->
    <div id="registerScreen" class="auth-screen hidden">
        <div class="auth-logo">
            <i class="fas fa-water"></i> SeePlay
        </div>
        <div class="auth-form">
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" id="registerName" class="form-input" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="registerEmail" class="form-input" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="registerPassword" class="form-input" placeholder="Create a password">
            </div>
            <div class="form-group">
                <label class="form-label">Confirm Password</label>
                <input type="password" id="registerConfirmPassword" class="form-input" placeholder="Confirm your password">
            </div>
            <div class="form-group">
                <label class="form-label">4-Digit PIN</label>
                <input type="password" id="registerPin" class="form-input" placeholder="Create a 4-digit PIN" maxlength="4">
            </div>
            <div class="form-group">
                <label class="form-label">Age</label>
                <input type="number" id="registerAge" class="form-input" placeholder="Enter your age">
            </div>
            <div class="form-group">
                <label class="form-label">Country</label>
                <select id="registerCountry" class="form-input">
                    <option value="">Select your country</option>
                    <option value="nigeria">Nigeria</option>
                    <option value="ghana">Ghana</option>
                    <option value="south-africa">South Africa</option>
                    <option value="kenya">Kenya</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Referral Code (Optional)</label>
                <input type="text" id="referralCodeInput" class="form-input" placeholder="Enter referral code if any">
            </div>
            <button id="registerButton" class="auth-button">
                <span id="registerButtonText">Create Account</span>
                <span id="registerSpinner" class="loading hidden"></span>
            </button>
            <div class="auth-link">
                Already have an account? <a href="#" id="showLogin">Login</a>
            </div>
        </div>
    </div>
    
    <!-- Admin Login Screen -->
    <div id="adminLoginScreen" class="auth-screen hidden">
        <div class="auth-logo">
            <i class="fas fa-crown"></i> Lord Panel
        </div>
        <div class="auth-form">
            <div class="form-group">
                <label class="form-label">Admin Email</label>
                <input type="email" id="adminEmail" class="form-input" placeholder="Enter admin email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="adminPassword" class="form-input" placeholder="Enter admin password">
            </div>
            <button id="adminLoginButton" class="auth-button">
                <span id="adminLoginButtonText">Login as Lord</span>
                <span id="adminLoginSpinner" class="loading hidden"></span>
            </button>
            <div class="auth-link">
                <a href="#" id="showUserLogin">Back to User Login</a>
            </div>
        </div>
    </div>
    
    <!-- Main App Screen -->
    <div id="appScreen" class="container hidden">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-water"></i> SeePlay
            </div>
            <div class="time-display" id="currentTime">9:25</div>
            <div class="winning-users" id="winningUsers">
                <div class="winning-user">
                    <i class="fas fa-trophy"></i>
                    <span>Welcome to SeePlay!</span>
                </div>
            </div>
            <button class="logout-btn" id="logoutButton">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Balance Card -->
            <div class="balance-card">
                <div class="balance-title">Your Balance</div>
                <div class="balance-amount" id="userBalance">0 SEE</div>
                <div class="balance-stats">
                    <div class="stat-item">
                        <div>USD Value</div>
                        <div class="stat-value" id="usdValue">$0.00</div>
                    </div>
                    <div class="stat-item">
                        <div>Games Played</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-item">
                        <div>Referrals</div>
                        <div class="stat-value" id="referralsCount">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="games">Games</div>
                <div class="nav-tab" data-tab="p2p">P2P Market</div>
                <div class="nav-tab" data-tab="transfer">Transfer</div>
                <div class="nav-tab" data-tab="profile">Profile</div>
            </div>
            
            <!-- Games Section -->
            <div id="gamesSection" class="tab-content">
                <div class="section-header">
                    <div class="section-title">Casino Games</div>
                </div>
                
                <div class="games-grid">
                    <div class="game-card" data-game="mines">
                        <div class="game-icon"><i class="fas fa-bomb"></i></div>
                        <div class="game-name">Mines</div>
                    </div>
                </div>
                
                <div class="promo-banner">
                    <div class="promo-title">PLAY MINES & WIN BIG!</div>
                    <div class="promo-subtitle">Up to 155,000x Multiplier Possible</div>
                </div>
                
                <div class="section-header">
                    <div class="section-title">Recent Winners</div>
                </div>
                
                <div class="transaction-section">
                    <div class="transaction-list" id="recentWinners">
                        <div style="text-align: center; padding: 20px; opacity: 0.7;">
                            <i class="fas fa-trophy" style="font-size: 40px; margin-bottom: 10px;"></i>
                            <div>No recent winners yet</div>
                            <div style="font-size: 12px; margin-top: 5px;">Be the first to win big!</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- P2P Section -->
            <div id="p2pSection" class="tab-content hidden">
                <div class="section-header">
                    <div class="section-title">P2P Marketplace</div>
                </div>
                
                <div class="balance-card">
                    <div class="balance-title">Available Offers</div>
                    <div class="balance-amount" id="activeSellersCount">1 Active Seller</div>
                    <div class="balance-stats">
                        <div class="stat-item">
                            <div>Price/SEE</div>
                            <div class="stat-value" id="seaCoinPrice">$1.01</div>
                        </div>
                        <div class="stat-item">
                            <div>Your Balance</div>
                            <div class="stat-value" id="p2pBalance">0 SEE</div>
                        </div>
                        <div class="stat-item">
                            <div>Min. Trade</div>
                            <div class="stat-value">5 SEE</div>
                        </div>
                    </div>
                </div>
                
                <div class="promo-banner">
                    <div class="promo-title">BECOME A SELLER</div>
                    <div class="promo-subtitle">Requires 2+ SEE Balance</div>
                    <button class="promo-button" id="becomeSellerBtn">SELL SEE COINS</button>
                </div>
                
                <div class="section-header">
                    <div class="section-title">Available Sellers</div>
                </div>
                
                <div class="p2p-section">
                    <div class="p2p-offer">
                        <div class="p2p-offer-header">
                            <div class="p2p-seller">SeePlay Official</div>
                            <div class="p2p-rating">5.0★</div>
                        </div>
                        <div class="p2p-offer-details">
                            <div>Price: $1.01 per SEE</div>
                            <div>Available: Unlimited</div>
                        </div>
                        <div class="p2p-offer-details">
                            <div class="p2p-phone">Phone: 07079191406</div>
                            <div>Min: 5 SEE</div>
                        </div>
                        <div class="match-odds">
                            <div class="odd" id="buyFromAdminBtn">Buy Now</div>
                        </div>
                    </div>
                </div>
                
                <div class="section-header">
                    <div class="section-title">Your P2P Transactions</div>
                </div>
                
                <div class="transaction-section">
                    <div class="transaction-list" id="p2pTransactions">
                        <div style="text-align: center; padding: 20px; opacity: 0.7;">
                            <i class="fas fa-exchange-alt" style="font-size: 40px; margin-bottom: 10px;"></i>
                            <div>No P2P transactions yet</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Transfer Section -->
            <div id="transferSection" class="tab-content hidden">
                <div class="section-header">
                    <div class="section-title">Transfer SEE Coins</div>
                </div>
                
                <div class="profile-section">
                    <div class="form-group">
                        <label class="form-label">Recipient Email</label>
                        <input type="email" id="transferEmail" class="form-input" placeholder="Enter recipient's email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount (Min. 1 SEE)</label>
                        <input type="number" id="transferAmount" class="form-input" placeholder="Enter amount" min="1" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">4-Digit PIN</label>
                        <input type="password" id="transferPin" class="form-input" placeholder="Enter your PIN" maxlength="4">
                    </div>
                    <button class="auth-button" id="sendTransferBtn">
                        <span id="sendTransferText">Send SEE</span>
                        <span id="sendTransferSpinner" class="loading hidden"></span>
                    </button>
                </div>
                
                <div class="section-header">
                    <div class="section-title">Transaction History</div>
                </div>
                
                <div class="transaction-section">
                    <div class="transaction-list" id="transferHistory">
                        <div style="text-align: center; padding: 20px; opacity: 0.7;">
                            <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                            <div>No transactions yet</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Section -->
            <div id="profileSection" class="tab-content hidden">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileUserName">User Name</div>
                            <div class="profile-email" id="profileUserEmail">user@example.com</div>
                        </div>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileGamesPlayed">0</div>
                            <div class="profile-stat-label">Games Played</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileWins">0</div>
                            <div class="profile-stat-label">Wins</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileReferrals">0</div>
                            <div class="profile-stat-label">Referrals</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Your Referral Code</label>
                        <input type="text" class="form-input" id="userReferralCode" readonly>
                    </div>
                    <button class="auth-button" style="margin-top: 10px;" id="copyReferralBtn">Copy Referral Code</button>
                </div>
                
                <div class="referral-section">
                    <div class="section-header">
                        <div class="section-title">Your Referrals</div>
                    </div>
                    <div class="referral-list" id="referralList">
                        <div style="text-align: center; padding: 20px; opacity: 0.7;">
                            <i class="fas fa-user-friends" style="font-size: 40px; margin-bottom: 10px;"></i>
                            <div>No referrals yet</div>
                            <div style="font-size: 12px; margin-top: 5px;">Share your code to earn 3 SEE for every 10 referrals</div>
                        </div>
                    </div>
                    <button class="auth-button" id="claimReferralBtn" disabled>Claim Referral Bonus (0/10)</button>
                </div>
                
                <div class="profile-section">
                    <div class="section-header">
                        <div class="section-title">Change PIN</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Current PIN</label>
                        <input type="password" class="form-input" id="currentPin" placeholder="Enter current PIN" maxlength="4">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">New PIN</label>
                        <input type="password" class="form-input" id="newPin" placeholder="Enter new 4-digit PIN" maxlength="4">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm New PIN</label>
                        <input type="password" class="form-input" id="confirmNewPin" placeholder="Confirm new PIN" maxlength="4">
                    </div>
                    
                    <button class="auth-button" id="changePinBtn">Change PIN</button>
                </div>
                
                <div class="profile-section">
                    <div class="section-header">
                        <div class="section-title">Price Chart</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-nav="home">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div>Home</div>
            </div>
            <div class="nav-item" data-nav="games">
                <div class="nav-icon"><i class="fas fa-gamepad"></i></div>
                <div>Games</div>
            </div>
            <div class="nav-item" data-nav="p2p">
                <div class="nav-icon"><i class="fas fa-exchange-alt"></i></div>
                <div>P2P</div>
            </div>
            <div class="nav-item" data-nav="transfer">
                <div class="nav-icon"><i class="fas fa-wallet"></i></div>
                <div>Transfer</div>
            </div>
            <div class="nav-item" data-nav="profile">
                <div class="nav-icon"><i class="fas fa-user"></i></div>
                <div>Profile</div>
            </div>
        </div>
    </div>
    
    <!-- Game Screens -->
    <div id="gameScreens" class="hidden">
        <!-- Mines Game -->
        <div id="minesGame" class="game-screen hidden">
            <button class="back-btn" id="minesBackBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="game-header">
                <div class="game-title">Mines</div>
                <div class="game-balance" id="minesBalance">0 SEE</div>
            </div>
            
            <div class="mines-settings">
                <div class="mines-setting">
                    <div class="mines-setting-label">Mines</div>
                    <div class="mines-setting-value" id="minesCount">3</div>
                    <div class="mines-setting-controls">
                        <button class="mines-control-btn" id="decreaseMines">-</button>
                        <button class="mines-control-btn" id="increaseMines">+</button>
                    </div>
                </div>
                <div class="mines-setting">
                    <div class="mines-setting-label">Bet Amount</div>
                    <div class="mines-setting-value" id="minesBetAmountDisplay">0.50 SEE</div>
                    <div class="mines-setting-controls">
                        <button class="mines-control-btn" id="decreaseBet">-</button>
                        <button class="mines-control-btn" id="increaseBet">+</button>
                    </div>
                </div>
            </div>
            
            <div class="game-area">
                <div class="mines-multiplier-display" id="minesMultiplier">Multiplier: 1.00x</div>
                <div class="mines-cashout-amount" id="minesCashoutAmount">Cashout: 0.00 SEE</div>
                <div class="mines-grid" id="minesGrid">
                    <!-- Mines grid will be generated here -->
                </div>
            </div>
            <div class="bet-controls">
                <button class="bet-button" id="minesPlayButton">PLAY</button>
                <button class="bet-button" id="minesCashoutButton" disabled>CASHOUT</button>
            </div>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" class="container hidden">
        <div class="header">
            <div class="logo">
                <i class="fas fa-crown"></i> Lord Panel
            </div>
            <button class="logout-btn" id="adminLogoutButton">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        
        <div class="admin-panel">
            <div class="admin-header">
                <div class="admin-title">Admin Dashboard</div>
            </div>
            
            <div class="admin-stats">
                <div class="admin-stat">
                    <div class="admin-stat-value" id="totalUsers">0</div>
                    <div class="admin-stat-label">Total Users</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="totalBalance">0 SEE</div>
                    <div class="admin-stat-label">User Balances</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="vaultBalance">50,000,000,000 SEE</div>
                    <div class="admin-stat-label">Vault Balance</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="activeGames">0</div>
                    <div class="admin-stat-label">Active Games</div>
                </div>
            </div>
            
            <div class="admin-actions">
                <button class="admin-action" id="addCoinsBtn">Add Coins to User</button>
                <button class="admin-action" id="banUserBtn">Ban User</button>
                <button class="admin-action" id="messageUserBtn">Message User</button>
                <button class="admin-action" id="setPriceBtn">Set SeaCoin Price</button>
            </div>
            
            <div class="section-header">
                <div class="section-title">All Users</div>
            </div>
            
            <div class="users-list" id="usersList">
                <!-- Users will be listed here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDDruUr6ONHIqZqNmvbnSfMF3nTlbejcvU",
            authDomain: "seaplay-6a197.firebaseapp.com",
            projectId: "seaplay-6a197",
            storageBucket: "seaplay-6a197.firebasestorage.app",
            messagingSenderId: "419084403907",
            appId: "1:419084403907:web:2ef95d7c804c92f4808e76",
            measurementId: "G-LDY3ZLKJFF"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const registerScreen = document.getElementById('registerScreen');
        const adminLoginScreen = document.getElementById('adminLoginScreen');
        const appScreen = document.getElementById('appScreen');
        const adminPanel = document.getElementById('adminPanel');
        const gameScreens = document.getElementById('gameScreens');
        
        // Auth buttons and spinners
        const loginButton = document.getElementById('loginButton');
        const loginButtonText = document.getElementById('loginButtonText');
        const loginSpinner = document.getElementById('loginSpinner');
        const registerButton = document.getElementById('registerButton');
        const registerButtonText = document.getElementById('registerButtonText');
        const registerSpinner = document.getElementById('registerSpinner');
        const adminLoginButton = document.getElementById('adminLoginButton');
        const adminLoginButtonText = document.getElementById('adminLoginButtonText');
        const adminLoginSpinner = document.getElementById('adminLoginSpinner');
        const sendTransferBtn = document.getElementById('sendTransferBtn');
        const sendTransferText = document.getElementById('sendTransferText');
        const sendTransferSpinner = document.getElementById('sendTransferSpinner');
        
        const logoutButton = document.getElementById('logoutButton');
        const adminLogoutButton = document.getElementById('adminLogoutButton');
        
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const showAdminLogin = document.getElementById('showAdminLogin');
        const showUserLogin = document.getElementById('showUserLogin');
        
        // Game elements
        const minesPlayButton = document.getElementById('minesPlayButton');
        const minesCashoutButton = document.getElementById('minesCashoutButton');
        const minesMultiplier = document.getElementById('minesMultiplier');
        const minesCashoutAmount = document.getElementById('minesCashoutAmount');
        const minesGrid = document.getElementById('minesGrid');
        const minesBackBtn = document.getElementById('minesBackBtn');
        const minesCount = document.getElementById('minesCount');
        const minesBetAmountDisplay = document.getElementById('minesBetAmountDisplay');
        const decreaseMines = document.getElementById('decreaseMines');
        const increaseMines = document.getElementById('increaseMines');
        const decreaseBet = document.getElementById('decreaseBet');
        const increaseBet = document.getElementById('increaseBet');
        
        // Admin elements
        const addCoinsBtn = document.getElementById('addCoinsBtn');
        const banUserBtn = document.getElementById('banUserBtn');
        const messageUserBtn = document.getElementById('messageUserBtn');
        const setPriceBtn = document.getElementById('setPriceBtn');
        const usersList = document.getElementById('usersList');
        
        // Profile elements
        const profileUserName = document.getElementById('profileUserName');
        const profileUserEmail = document.getElementById('profileUserEmail');
        const profileGamesPlayed = document.getElementById('profileGamesPlayed');
        const profileWins = document.getElementById('profileWins');
        const profileReferrals = document.getElementById('profileReferrals');
        const userReferralCode = document.getElementById('userReferralCode');
        const copyReferralBtn = document.getElementById('copyReferralBtn');
        const referralList = document.getElementById('referralList');
        const claimReferralBtn = document.getElementById('claimReferralBtn');
        
        // Transfer elements
        const transferEmail = document.getElementById('transferEmail');
        const transferAmount = document.getElementById('transferAmount');
        const transferPin = document.getElementById('transferPin');
        
        // P2P elements
        const becomeSellerBtn = document.getElementById('becomeSellerBtn');
        const buyFromAdminBtn = document.getElementById('buyFromAdminBtn');
        const seaCoinPrice = document.getElementById('seaCoinPrice');
        
        // App state
        let currentUser = null;
        let isAdmin = false;
        let userBalance = 0;
        let currentGame = null;
        let gameIntervals = {};
        let adminVaultBalance = 50000000000; // 50B SEE
        let seaCoinPriceValue = 1.01; // Default price
        
        // Mines game state
        let minesGameState = {
            betAmount: 0.50,
            minesCount: 3,
            grid: [],
            revealed: [],
            gameActive: false,
            cashoutMultiplier: 1.0,
            totalTiles: 25
        };
        
        // Price chart
        let priceChart = null;
        
        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('currentTime').textContent = timeString;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        // Show/Hide Screens
        function showScreen(screen) {
            loginScreen.classList.add('hidden');
            registerScreen.classList.add('hidden');
            adminLoginScreen.classList.add('hidden');
            appScreen.classList.add('hidden');
            adminPanel.classList.add('hidden');
            gameScreens.classList.add('hidden');
            
            screen.classList.remove('hidden');
        }
        
        // Show loading state
        function showLoading(button, textElement, spinner) {
            textElement.classList.add('hidden');
            spinner.classList.remove('hidden');
            button.disabled = true;
        }
        
        // Hide loading state
        function hideLoading(button, textElement, spinner) {
            textElement.classList.remove('hidden');
            spinner.classList.add('hidden');
            button.disabled = false;
        }
        
        // Navigation Functions
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            
            // Show selected tab content
            document.getElementById(`${tabName}Section`).classList.remove('hidden');
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Load data for specific tabs
            if (tabName === 'transfer') {
                loadTransferHistory();
            } else if (tabName === 'p2p') {
                loadP2PTransactions();
            } else if (tabName === 'profile') {
                updateProfile();
                initializePriceChart();
            }
        }
        
        function switchBottomNav(navItem) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.dataset.nav === navItem) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Handle navigation based on nav item
            switch(navItem) {
                case 'home':
                case 'games':
                    switchTab('games');
                    break;
                case 'p2p':
                    switchTab('p2p');
                    break;
                case 'transfer':
                    switchTab('transfer');
                    break;
                case 'profile':
                    switchTab('profile');
                    break;
            }
        }
        
        // Update profile information
        function updateProfile() {
            if (!currentUser) return;
            
            profileUserName.textContent = currentUser.name || 'User Name';
            profileUserEmail.textContent = currentUser.email || 'user@example.com';
            userReferralCode.value = currentUser.referralCode || 'SEE12345';
            
            // Update stats
            profileGamesPlayed.textContent = currentUser.gamesPlayed || 0;
            profileWins.textContent = currentUser.wins || 0;
            profileReferrals.textContent = currentUser.referrals ? currentUser.referrals.length : 0;
            
            // Update referral button
            const referralCount = currentUser.referrals ? currentUser.referrals.length : 0;
            claimReferralBtn.textContent = `Claim Referral Bonus (${referralCount}/10)`;
            claimReferralBtn.disabled = referralCount < 10;
            
            // Update referral list
            updateReferralList();
        }
        
        // Update referral list
        function updateReferralList() {
            const referrals = currentUser.referrals || [];
            referralList.innerHTML = '';
            
            if (referrals.length === 0) {
                referralList.innerHTML = `
                    <div style="text-align: center; padding: 20px; opacity: 0.7;">
                        <i class="fas fa-user-friends" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <div>No referrals yet</div>
                        <div style="font-size: 12px; margin-top: 5px;">Share your code to earn 3 SEE for every 10 referrals</div>
                    </div>
                `;
            } else {
                referrals.forEach(ref => {
                    const refItem = document.createElement('div');
                    refItem.className = 'referral-item';
                    refItem.innerHTML = `
                        <div>${ref.email}</div>
                        <div>${new Date(ref.date).toLocaleDateString()}</div>
                    `;
                    referralList.appendChild(refItem);
                });
            }
        }
        
        // Initialize price chart
        function initializePriceChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // Generate sample price data
            const prices = [];
            const labels = [];
            let currentPrice = seaCoinPriceValue;
            
            for (let i = 30; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString());
                
                // Simulate price fluctuations
                currentPrice += (Math.random() - 0.5) * 0.1;
                currentPrice = Math.max(0.5, Math.min(2.0, currentPrice)); // Keep between 0.5 and 2.0
                prices.push(currentPrice);
            }
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'SeaCoin Price ($)',
                        data: prices,
                        borderColor: '#00b0ff',
                        backgroundColor: 'rgba(0, 176, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }
        
        // Generate unique referral code
        function generateReferralCode() {
            return 'SEE' + Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        // Update user balance display
        function updateBalance() {
            document.getElementById('userBalance').textContent = `${userBalance.toFixed(2)} SEE`;
            document.getElementById('p2pBalance').textContent = `${userBalance.toFixed(2)} SEE`;
            document.getElementById('usdValue').textContent = `$${(userBalance * seaCoinPriceValue).toFixed(2)}`;
            document.getElementById('gamesPlayed').textContent = currentUser.gamesPlayed || 0;
            document.getElementById('referralsCount').textContent = currentUser.referrals ? currentUser.referrals.length : 0;
            
            document.querySelectorAll('.game-balance').forEach(el => {
                el.textContent = `${userBalance.toFixed(2)} SEE`;
            });
            
            // Update vault balance in admin panel
            document.getElementById('vaultBalance').textContent = `${adminVaultBalance.toLocaleString()} SEE`;
            
            // Enable/disable P2P seller button based on balance
            if (userBalance >= 2) {
                becomeSellerBtn.disabled = false;
            } else {
                becomeSellerBtn.disabled = true;
            }
        }
        
        // Record transaction
        function recordTransaction(type, amount, description, recipient = null) {
            const transaction = {
                id: Date.now().toString(),
                type: type,
                amount: amount,
                description: description,
                date: new Date().toISOString(),
                userId: currentUser.uid
            };
            
            if (recipient) {
                transaction.recipient = recipient;
            }
            
            // Save to Firestore
            db.collection('transactions').doc(transaction.id).set(transaction)
                .then(() => {
                    console.log('Transaction recorded:', transaction);
                })
                .catch(error => {
                    console.error('Error recording transaction:', error);
                });
            
            // Update user stats if it's a game transaction
            if (type === 'game_win' || type === 'game_loss') {
                const userRef = db.collection('users').doc(currentUser.uid);
                userRef.update({
                    gamesPlayed: firebase.firestore.FieldValue.increment(1)
                });
                
                if (type === 'game_win') {
                    userRef.update({
                        wins: firebase.firestore.FieldValue.increment(1)
                    });
                }
            }
        }
        
        // Load transfer history
        function loadTransferHistory() {
            if (!currentUser) return;
            
            const transferHistory = document.getElementById('transferHistory');
            transferHistory.innerHTML = '<div class="loading" style="margin: 20px auto;"></div>';
            
            db.collection('transactions')
                .where('userId', '==', currentUser.uid)
                .orderBy('date', 'desc')
                .limit(10)
                .get()
                .then(snapshot => {
                    transferHistory.innerHTML = '';
                    
                    if (snapshot.empty) {
                        transferHistory.innerHTML = `
                            <div style="text-align: center; padding: 20px; opacity: 0.7;">
                                <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <div>No transactions yet</div>
                            </div>
                        `;
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        const transactionItem = document.createElement('div');
                        transactionItem.className = 'transaction-item';
                        
                        const amountClass = transaction.amount > 0 ? 'positive' : 'negative';
                        const amountSign = transaction.amount > 0 ? '+' : '';
                        
                        transactionItem.innerHTML = `
                            <div>
                                <div class="transaction-type">${transaction.description}</div>
                                <div style="font-size: 12px; opacity: 0.7;">${new Date(transaction.date).toLocaleString()}</div>
                            </div>
                            <div class="transaction-amount ${amountClass}">${amountSign}${transaction.amount} SEE</div>
                        `;
                        
                        transferHistory.appendChild(transactionItem);
                    });
                })
                .catch(error => {
                    console.error('Error loading transfer history:', error);
                    transferHistory.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--danger);">Error loading transactions</div>';
                });
        }
        
        // Load P2P transactions
        function loadP2PTransactions() {
            if (!currentUser) return;
            
            const p2pTransactions = document.getElementById('p2pTransactions');
            p2pTransactions.innerHTML = '<div class="loading" style="margin: 20px auto;"></div>';
            
            db.collection('transactions')
                .where('userId', '==', currentUser.uid)
                .where('type', 'in', ['p2p_buy', 'p2p_sell'])
                .orderBy('date', 'desc')
                .limit(10)
                .get()
                .then(snapshot => {
                    p2pTransactions.innerHTML = '';
                    
                    if (snapshot.empty) {
                        p2pTransactions.innerHTML = `
                            <div style="text-align: center; padding: 20px; opacity: 0.7;">
                                <i class="fas fa-exchange-alt" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <div>No P2P transactions yet</div>
                            </div>
                        `;
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        const transactionItem = document.createElement('div');
                        transactionItem.className = 'transaction-item';
                        
                        const amountClass = transaction.amount > 0 ? 'positive' : 'negative';
                        const amountSign = transaction.amount > 0 ? '+' : '';
                        
                        transactionItem.innerHTML = `
                            <div>
                                <div class="transaction-type">${transaction.description}</div>
                                <div style="font-size: 12px; opacity: 0.7;">${new Date(transaction.date).toLocaleString()}</div>
                            </div>
                            <div class="transaction-amount ${amountClass}">${amountSign}${transaction.amount} SEE</div>
                        `;
                        
                        p2pTransactions.appendChild(transactionItem);
                    });
                })
                .catch(error => {
                    console.error('Error loading P2P transactions:', error);
                    p2pTransactions.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--danger);">Error loading transactions</div>';
                });
        }
        
        // Game Functions
        function startGame(gameName) {
            currentGame = gameName;
            appScreen.classList.add('hidden');
            document.getElementById(`${gameName}Game`).classList.remove('hidden');
            gameScreens.classList.remove('hidden');
            
            // Update game balance
            document.querySelectorAll('.game-balance').forEach(el => {
                el.textContent = `${userBalance.toFixed(2)} SEE`;
            });
            
            // Initialize specific game
            if (gameName === 'mines') {
                initializeMinesGame();
            }
        }
        
        function exitGame() {
            gameScreens.classList.add('hidden');
            appScreen.classList.remove('hidden');
            currentGame = null;
            
            // Clear any game intervals
            Object.values(gameIntervals).forEach(interval => clearInterval(interval));
            gameIntervals = {};
        }
        
        // Mines Game Logic
        function initializeMinesGame() {
            minesBetAmountDisplay.textContent = `${minesGameState.betAmount.toFixed(2)} SEE`;
            minesCount.textContent = minesGameState.minesCount;
            generateMinesGrid();
            updateMinesCashout();
        }
        
        function generateMinesGrid() {
            minesGrid.innerHTML = '';
            minesGameState.grid = [];
            minesGameState.revealed = [];
            minesGameState.gameActive = false;
            minesGameState.cashoutMultiplier = 1.0;
            
            // Create 5x5 grid
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'mine-cell';
                cell.dataset.index = i;
                cell.innerHTML = '💎';
                cell.addEventListener('click', () => revealMineCell(i));
                
                minesGrid.appendChild(cell);
                minesGameState.grid.push('gem'); // Start with all gems
            }
            
            // Place mines randomly
            let minesPlaced = 0;
            while (minesPlaced < minesGameState.minesCount) {
                const randomIndex = Math.floor(Math.random() * 25);
                if (minesGameState.grid[randomIndex] === 'gem') {
                    minesGameState.grid[randomIndex] = 'mine';
                    minesPlaced++;
                }
            }
            
            minesPlayButton.disabled = false;
            minesCashoutButton.disabled = true;
            minesMultiplier.textContent = 'Multiplier: 1.00x';
        }
        
        function revealMineCell(index) {
            if (!minesGameState.gameActive || minesGameState.revealed.includes(index)) {
                return;
            }
            
            minesGameState.revealed.push(index);
            const cell = minesGrid.children[index];
            cell.classList.add('revealed');
            
            if (minesGameState.grid[index] === 'mine') {
                // Hit a mine - game over
                cell.innerHTML = '💣';
                cell.classList.add('mine');
                minesGameState.gameActive = false;
                minesCashoutButton.disabled = true;
                
                // Reveal all mines
                for (let i = 0; i < 25; i++) {
                    if (minesGameState.grid[i] === 'mine') {
                        const mineCell = minesGrid.children[i];
                        mineCell.innerHTML = '💣';
                        mineCell.classList.add('mine');
                    }
                }
                
                // Record transaction
                recordTransaction('game_loss', -minesGameState.betAmount, 'Mines game loss');
                
                setTimeout(() => {
                    alert('Game Over! You hit a mine.');
                    initializeMinesGame();
                }, 2000);
            } else {
                // Found a gem - calculate new multiplier
                const safeTilesRemaining = 25 - minesGameState.minesCount - minesGameState.revealed.length;
                const totalRemainingTiles = 25 - minesGameState.revealed.length;
                
                // Calculate multiplier using the exact formula
                minesGameState.cashoutMultiplier = calculateMinesMultiplier(
                    minesGameState.minesCount, 
                    minesGameState.revealed.length
                );
                
                cell.innerHTML = '💎';
                cell.classList.add('gem');
                
                updateMinesCashout();
                
                // Check if all gems are found
                const totalGems = 25 - minesGameState.minesCount;
                if (minesGameState.revealed.length === totalGems) {
                    // All gems found - auto cashout
                    cashoutMines();
                }
            }
        }
        
        // Calculate mines multiplier using exact formula
        function calculateMinesMultiplier(minesCount, safeTilesRevealed) {
            let multiplier = 1.0;
            const totalTiles = 25;
            const safeTiles = totalTiles - minesCount;
            
            for (let i = 0; i < safeTilesRevealed; i++) {
                multiplier *= (totalTiles - i) / (safeTiles - i);
            }
            
            return parseFloat(multiplier.toFixed(2));
        }
        
        function updateMinesCashout() {
            const cashoutAmount = (minesGameState.betAmount * minesGameState.cashoutMultiplier).toFixed(2);
            minesCashoutAmount.textContent = `Cashout: ${cashoutAmount} SEE`;
            minesMultiplier.textContent = `Multiplier: ${minesGameState.cashoutMultiplier.toFixed(2)}x`;
        }
        
        function startMinesGame() {
            if (userBalance < minesGameState.betAmount) {
                alert('Insufficient balance!');
                return;
            }
            
            // Deduct from user and add to vault
            userBalance -= minesGameState.betAmount;
            adminVaultBalance += minesGameState.betAmount;
            updateBalance();
            
            minesGameState.gameActive = true;
            minesPlayButton.disabled = true;
            minesCashoutButton.disabled = false;
            minesGameState.cashoutMultiplier = 1.0;
            updateMinesCashout();
            
            // Record game start
            recordTransaction('game_bet', -minesGameState.betAmount, 'Mines game bet');
        }
        
        function cashoutMines() {
            const winAmount = minesGameState.betAmount * minesGameState.cashoutMultiplier;
            
            // Check if vault has enough funds
            if (adminVaultBalance < winAmount) {
                alert('Insufficient funds in vault!');
                return;
            }
            
            // Transfer from vault to user
            userBalance += winAmount;
            adminVaultBalance -= winAmount;
            updateBalance();
            
            minesCashoutButton.disabled = true;
            minesPlayButton.disabled = false;
            minesGameState.gameActive = false;
            
            // Record transaction
            recordTransaction('game_win', winAmount - minesGameState.betAmount, `Mines win with ${minesGameState.cashoutMultiplier.toFixed(2)}x multiplier`);
            
            // Update user stats
            if (currentUser && currentUser.uid) {
                db.collection('users').doc(currentUser.uid).update({
                    gamesPlayed: firebase.firestore.FieldValue.increment(1),
                    wins: firebase.firestore.FieldValue.increment(1)
                });
            }
            
            // Reveal all tiles
            for (let i = 0; i < 25; i++) {
                const cell = minesGrid.children[i];
                if (minesGameState.grid[i] === 'mine') {
                    cell.innerHTML = '💣';
                    cell.classList.add('mine');
                } else {
                    cell.innerHTML = '💎';
                    cell.classList.add('gem');
                }
                cell.classList.add('revealed');
            }
            
            setTimeout(() => {
                alert(`You cashed out ${winAmount.toFixed(2)} SEE!`);
                initializeMinesGame();
            }, 1000);
        }
        
        // Mines controls
        decreaseMines.addEventListener('click', () => {
            if (minesGameState.minesCount > 1) {
                minesGameState.minesCount--;
                minesCount.textContent = minesGameState.minesCount;
                generateMinesGrid();
            }
        });
        
        increaseMines.addEventListener('click', () => {
            if (minesGameState.minesCount < 24) {
                minesGameState.minesCount++;
                minesCount.textContent = minesGameState.minesCount;
                generateMinesGrid();
            }
        });
        
        decreaseBet.addEventListener('click', () => {
            if (minesGameState.betAmount > 0.50) {
                minesGameState.betAmount -= 0.10;
                minesBetAmountDisplay.textContent = `${minesGameState.betAmount.toFixed(2)} SEE`;
                updateMinesCashout();
            }
        });
        
        increaseBet.addEventListener('click', () => {
            if (minesGameState.betAmount < 100.00) {
                minesGameState.betAmount += 0.10;
                minesBetAmountDisplay.textContent = `${minesGameState.betAmount.toFixed(2)} SEE`;
                updateMinesCashout();
            }
        });
        
        // Admin Functions
        function loadAdminPanel() {
            // Load all users
            db.collection('users').get()
                .then(snapshot => {
                    usersList.innerHTML = '';
                    let totalUsers = 0;
                    let totalBalance = 0;
                    
                    if (snapshot.empty) {
                        usersList.innerHTML = '<div style="text-align: center; padding: 20px; opacity: 0.7;">No users registered yet</div>';
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        if (user.email === 'ebubechichukwu8@gmail.com') return; // Skip admin
                        
                        totalUsers++;
                        totalBalance += user.balance || 0;
                        
                        const userItem = document.createElement('div');
                        userItem.className = 'user-item';
                        userItem.innerHTML = `
                            <div class="user-info">
                                <div class="user-name">${user.name || 'Unknown'}</div>
                                <div class="user-email">${user.email}</div>
                            </div>
                            <div class="user-balance">${(user.balance || 0).toFixed(2)} SEE</div>
                            <div class="user-actions">
                                <button class="user-action" title="Add Coins" data-email="${user.email}">
                                    <i class="fas fa-coins"></i>
                                </button>
                                <button class="user-action" title="Ban User" data-email="${user.email}">
                                    <i class="fas fa-ban"></i>
                                </button>
                                <button class="user-action" title="Message User" data-email="${user.email}">
                                    <i class="fas fa-envelope"></i>
                                </button>
                            </div>
                        `;
                        usersList.appendChild(userItem);
                    });
                    
                    // Update admin stats
                    document.getElementById('totalUsers').textContent = totalUsers;
                    document.getElementById('totalBalance').textContent = `${totalBalance.toFixed(2)} SEE`;
                    
                    // Add event listeners to user actions
                    document.querySelectorAll('.user-action[title="Add Coins"]').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const userEmail = this.dataset.email;
                            addCoinsToUser(userEmail);
                        });
                    });
                    
                    document.querySelectorAll('.user-action[title="Ban User"]').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const userEmail = this.dataset.email;
                            banUser(userEmail);
                        });
                    });
                    
                    document.querySelectorAll('.user-action[title="Message User"]').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const userEmail = this.dataset.email;
                            messageUser(userEmail);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading users:', error);
                    usersList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--danger);">Error loading users</div>';
                });
        }
        
        function addCoinsToUser(userEmail) {
            const amount = parseFloat(prompt(`Enter amount of SEE to add to ${userEmail}:`));
            if (!amount || isNaN(amount) || amount <= 0) {
                alert('Invalid amount!');
                return;
            }
            
            // Check if vault has enough funds
            if (adminVaultBalance < amount) {
                alert('Insufficient funds in vault!');
                return;
            }
            
            // Find user and update balance
            db.collection('users').where('email', '==', userEmail).get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        alert('User not found!');
                        return;
                    }
                    
                    const userDoc = snapshot.docs[0];
                    const currentBalance = userDoc.data().balance || 0;
                    const newBalance = currentBalance + amount;
                    
                    // Update user balance
                    db.collection('users').doc(userDoc.id).update({
                        balance: newBalance
                    })
                    .then(() => {
                        // Update vault balance
                        adminVaultBalance -= amount;
                        updateBalance();
                        
                        // Record transaction
                        db.collection('transactions').add({
                            type: 'admin_credit',
                            amount: amount,
                            description: `Admin credit to ${userEmail}`,
                            date: new Date().toISOString(),
                            userId: userDoc.id,
                            adminId: 'admin'
                        });
                        
                        alert(`Added ${amount} SEE to ${userEmail}`);
                        loadAdminPanel(); // Refresh user list
                    })
                    .catch(error => {
                        console.error('Error updating user balance:', error);
                        alert('Error adding coins to user');
                    });
                })
                .catch(error => {
                    console.error('Error finding user:', error);
                    alert('Error finding user');
                });
        }
        
        function banUser(userEmail) {
            const reason = prompt(`Enter reason for banning ${userEmail}:`);
            if (!reason) return;
            
            // Find user and ban them
            db.collection('users').where('email', '==', userEmail).get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        alert('User not found!');
                        return;
                    }
                    
                    const userDoc = snapshot.docs[0];
                    const userBalance = userDoc.data().balance || 0;
                    
                    // Add balance to vault and set user balance to 0
                    adminVaultBalance += userBalance;
                    
                    db.collection('users').doc(userDoc.id).update({
                        balance: 0,
                        banned: true,
                        banReason: reason
                    })
                    .then(() => {
                        updateBalance();
                        alert(`User ${userEmail} has been banned and their balance confiscated`);
                        loadAdminPanel(); // Refresh user list
                    })
                    .catch(error => {
                        console.error('Error banning user:', error);
                        alert('Error banning user');
                    });
                })
                .catch(error => {
                    console.error('Error finding user:', error);
                    alert('Error finding user');
                });
        }
        
        function messageUser(userEmail) {
            const message = prompt(`Enter message to send to ${userEmail}:`);
            if (!message) return;
            
            // In a real app, this would save to a messages collection
            alert(`Message sent to ${userEmail}: "${message}"`);
        }
        
        function setSeaCoinPrice() {
            const newPrice = parseFloat(prompt('Enter new SeaCoin price in USD:'));
            if (!newPrice || isNaN(newPrice) || newPrice <= 0) {
                alert('Invalid price!');
                return;
            }
            
            seaCoinPriceValue = newPrice;
            seaCoinPrice.textContent = `$${newPrice.toFixed(2)}`;
            updateBalance();
            
            // Update price in Firestore
            db.collection('settings').doc('seaCoinPrice').set({
                value: newPrice,
                updatedAt: new Date().toISOString(),
                updatedBy: 'admin'
            })
            .then(() => {
                alert(`SeaCoin price updated to $${newPrice}`);
            })
            .catch(error => {
                console.error('Error updating SeaCoin price:', error);
            });
        }
        
        // Transfer SEE to another user
        function sendTransfer() {
            const recipientEmail = transferEmail.value.trim();
            const amount = parseFloat(transferAmount.value);
            const pin = transferPin.value;
            
            if (!recipientEmail) {
                alert('Please enter recipient email');
                return;
            }
            
            if (!amount || amount < 1) {
                alert('Please enter a valid amount (minimum 1 SEE)');
                return;
            }
            
            if (userBalance < amount) {
                alert('Insufficient balance!');
                return;
            }
            
            if (pin !== currentUser.pin) {
                alert('Invalid PIN!');
                return;
            }
            
            if (recipientEmail === currentUser.email) {
                alert('You cannot transfer to yourself!');
                return;
            }
            
            showLoading(sendTransferBtn, sendTransferText, sendTransferSpinner);
            
            // Find recipient
            db.collection('users').where('email', '==', recipientEmail).get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        hideLoading(sendTransferBtn, sendTransferText, sendTransferSpinner);
                        alert('Recipient not found!');
                        return;
                    }
                    
                    const recipientDoc = snapshot.docs[0];
                    const recipientData = recipientDoc.data();
                    
                    if (recipientData.banned) {
                        hideLoading(sendTransferBtn, sendTransferText, sendTransferSpinner);
                        alert('This user has been banned and cannot receive transfers');
                        return;
                    }
                    
                    // Update sender balance
                    userBalance -= amount;
                    
                    // Update recipient balance
                    const recipientNewBalance = (recipientData.balance || 0) + amount;
                    
                    // Perform both updates in a batch
                    const batch = db.batch();
                    
                    // Update sender
                    batch.update(db.collection('users').doc(currentUser.uid), {
                        balance: userBalance
                    });
                    
                    // Update recipient
                    batch.update(db.collection('users').doc(recipientDoc.id), {
                        balance: recipientNewBalance
                    });
                    
                    // Record transactions
                    const transactionId = Date.now().toString();
                    
                    // Sender transaction
                    batch.set(db.collection('transactions').doc(transactionId + '_sender'), {
                        id: transactionId + '_sender',
                        type: 'transfer_sent',
                        amount: -amount,
                        description: `Transfer to ${recipientEmail}`,
                        date: new Date().toISOString(),
                        userId: currentUser.uid,
                        recipient: recipientEmail
                    });
                    
                    // Recipient transaction
                    batch.set(db.collection('transactions').doc(transactionId + '_recipient'), {
                        id: transactionId + '_recipient',
                        type: 'transfer_received',
                        amount: amount,
                        description: `Transfer from ${currentUser.email}`,
                        date: new Date().toISOString(),
                        userId: recipientDoc.id,
                        sender: currentUser.email
                    });
                    
                    return batch.commit();
                })
                .then(() => {
                    hideLoading(sendTransferBtn, sendTransferText, sendTransferSpinner);
                    updateBalance();
                    loadTransferHistory();
                    
                    // Clear form
                    transferEmail.value = '';
                    transferAmount.value = '';
                    transferPin.value = '';
                    
                    alert(`Successfully transferred ${amount} SEE to ${recipientEmail}`);
                })
                .catch(error => {
                    hideLoading(sendTransferBtn, sendTransferText, sendTransferSpinner);
                    console.error('Error transferring SEE:', error);
                    alert('Error transferring SEE. Please try again.');
                });
        }
        
        // Buy SEE from admin
        function buyFromAdmin() {
            const amount = parseFloat(prompt('Enter amount of SEE to buy:'));
            if (!amount || amount < 5) {
                alert('Please enter a valid amount (minimum 5 SEE)');
                return;
            }
            
            const cost = amount * seaCoinPriceValue;
            const confirmPurchase = confirm(`Buy ${amount} SEE for $${cost.toFixed(2)}?\n\nYou will need to contact admin at 07079191406 to complete this transaction.`);
            
            if (confirmPurchase) {
                // In a real app, this would create a P2P trade record
                alert(`Purchase request for ${amount} SEE submitted!\n\nPlease contact admin at 07079191406 to complete your purchase.`);
                
                // Record P2P transaction
                recordTransaction('p2p_buy', amount, `P2P purchase of ${amount} SEE from admin`);
            }
        }
        
        // Event Listeners for Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                switchBottomNav(item.dataset.nav);
            });
        });
        
        // Game card clicks
        document.querySelectorAll('.game-card').forEach(card => {
            card.addEventListener('click', () => {
                const gameName = card.dataset.game;
                startGame(gameName);
            });
        });
        
        // Game controls
        minesPlayButton.addEventListener('click', startMinesGame);
        minesCashoutButton.addEventListener('click', cashoutMines);
        minesBackBtn.addEventListener('click', exitGame);
        
        // Copy referral code
        copyReferralBtn.addEventListener('click', () => {
            userReferralCode.select();
            document.execCommand('copy');
            alert('Referral code copied to clipboard!');
        });
        
        // Claim referral bonus
        claimReferralBtn.addEventListener('click', () => {
            if (currentUser.referrals && currentUser.referrals.length >= 10) {
                // Check if vault has enough funds
                if (adminVaultBalance < 3) {
                    alert('Insufficient funds in vault!');
                    return;
                }
                
                // Transfer from vault to user
                userBalance += 3;
                adminVaultBalance -= 3;
                updateBalance();
                
                // Record transaction
                recordTransaction('referral_bonus', 3, 'Referral bonus');
                
                alert('Referral bonus of 3 SEE has been added to your account!');
                
                // Reset referrals count
                db.collection('users').doc(currentUser.uid).update({
                    referrals: []
                })
                .then(() => {
                    currentUser.referrals = [];
                    updateProfile();
                })
                .catch(error => {
                    console.error('Error resetting referrals:', error);
                });
            }
        });
        
        // Change PIN
        document.getElementById('changePinBtn').addEventListener('click', () => {
            const currentPin = document.getElementById('currentPin').value;
            const newPin = document.getElementById('newPin').value;
            const confirmNewPin = document.getElementById('confirmNewPin').value;
            
            if (currentPin !== currentUser.pin) {
                alert('Current PIN is incorrect!');
                return;
            }
            
            if (newPin.length !== 4 || isNaN(newPin)) {
                alert('New PIN must be 4 digits!');
                return;
            }
            
            if (newPin !== confirmNewPin) {
                alert('New PINs do not match!');
                return;
            }
            
            // Update PIN in Firestore
            db.collection('users').doc(currentUser.uid).update({
                pin: newPin
            })
            .then(() => {
                currentUser.pin = newPin;
                alert('PIN changed successfully!');
                
                // Clear form
                document.getElementById('currentPin').value = '';
                document.getElementById('newPin').value = '';
                document.getElementById('confirmNewPin').value = '';
            })
            .catch(error => {
                console.error('Error changing PIN:', error);
                alert('Error changing PIN. Please try again.');
            });
        });
        
        // Transfer SEE
        sendTransferBtn.addEventListener('click', sendTransfer);
        
        // P2P actions
        becomeSellerBtn.addEventListener('click', () => {
            alert('To become a seller, please contact admin at 07079191406');
        });
        
        buyFromAdminBtn.addEventListener('click', buyFromAdmin);
        
        // Admin actions
        addCoinsBtn.addEventListener('click', () => {
            // This will use the user-specific buttons now
            alert('Please select a user from the list below and click the coin icon to add coins');
        });
        
        banUserBtn.addEventListener('click', () => {
            alert('Please select a user from the list below and click the ban icon to ban them');
        });
        
        messageUserBtn.addEventListener('click', () => {
            alert('Please select a user from the list below and click the message icon to message them');
        });
        
        setPriceBtn.addEventListener('click', setSeaCoinPrice);
        
        // Auth Event Listeners
        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            showScreen(registerScreen);
        });
        
        showLogin.addEventListener('click', (e) => {
            e.preventDefault();
            showScreen(loginScreen);
        });
        
        showAdminLogin.addEventListener('click', (e) => {
            e.preventDefault();
            showScreen(adminLoginScreen);
        });
        
        showUserLogin.addEventListener('click', (e) => {
            e.preventDefault();
            showScreen(loginScreen);
        });
        
        // Login function
        loginButton.addEventListener('click', () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            showLoading(loginButton, loginButtonText, loginSpinner);
            
            // Check if admin login
            if (email === 'ebubechichukwu8@gmail.com' && password === 'Ebube@123') {
                isAdmin = true;
                hideLoading(loginButton, loginButtonText, loginSpinner);
                showScreen(adminPanel);
                loadAdminPanel();
                return;
            }
            
            // Regular user login with Firebase Auth
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Get user data from Firestore
                    return db.collection('users').doc(user.uid).get();
                })
                .then((doc) => {
                    if (!doc.exists) {
                        throw new Error('User data not found');
                    }
                    
                    const userData = doc.data();
                    
                    if (userData.banned) {
                        throw new Error('Your account has been banned. Contact admin for more information.');
                    }
                    
                    currentUser = {
                        uid: doc.id,
                        ...userData
                    };
                    
                    userBalance = userData.balance || 0;
                    
                    hideLoading(loginButton, loginButtonText, loginSpinner);
                    updateBalance();
                    updateProfile();
                    showScreen(appScreen);
                })
                .catch((error) => {
                    hideLoading(loginButton, loginButtonText, loginSpinner);
                    alert('Login failed: ' + error.message);
                });
        });
        
        // Register function
        registerButton.addEventListener('click', () => {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const pin = document.getElementById('registerPin').value;
            const age = document.getElementById('registerAge').value;
            const country = document.getElementById('registerCountry').value;
            const referralCode = document.getElementById('referralCodeInput').value;
            
            if (!name || !email || !password || !confirmPassword || !pin || !age || !country) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (pin.length !== 4 || isNaN(pin)) {
                alert('PIN must be 4 digits');
                return;
            }
            
            if (parseInt(age) < 17) {
                alert('You must be at least 17 years old to register');
                return;
            }
            
            showLoading(registerButton, registerButtonText, registerSpinner);
            
            // Create user with Firebase Auth
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    const referralCode = generateReferralCode();
                    
                    // Create user document in Firestore
                    const userData = {
                        uid: user.uid,
                        name: name,
                        email: email,
                        pin: pin,
                        age: parseInt(age),
                        country: country,
                        balance: 0,
                        referralCode: referralCode,
                        referrals: [],
                        gamesPlayed: 0,
                        wins: 0,
                        createdAt: new Date().toISOString(),
                        banned: false
                    };
                    
                    // Handle referral if provided
                    if (referralCode) {
                        // Find referrer and update their referrals
                        return db.collection('users').where('referralCode', '==', referralCode).get()
                            .then((snapshot) => {
                                if (!snapshot.empty) {
                                    const referrerDoc = snapshot.docs[0];
                                    const referrerData = referrerDoc.data();
                                    
                                    // Add referral to referrer's list
                                    const newReferral = {
                                        email: email,
                                        date: new Date().toISOString()
                                    };
                                    
                                    const updatedReferrals = [...(referrerData.referrals || []), newReferral];
                                    
                                    return db.collection('users').doc(referrerDoc.id).update({
                                        referrals: updatedReferrals
                                    })
                                    .then(() => {
                                        return db.collection('users').doc(user.uid).set(userData);
                                    });
                                } else {
                                    return db.collection('users').doc(user.uid).set(userData);
                                }
                            });
                    } else {
                        return db.collection('users').doc(user.uid).set(userData);
                    }
                })
                .then(() => {
                    hideLoading(registerButton, registerButtonText, registerSpinner);
                    alert('Registration successful! Please login with your credentials.');
                    showScreen(loginScreen);
                })
                .catch((error) => {
                    hideLoading(registerButton, registerButtonText, registerSpinner);
                    alert('Registration failed: ' + error.message);
                });
        });
        
        // Admin login
        adminLoginButton.addEventListener('click', () => {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            showLoading(adminLoginButton, adminLoginButtonText, adminLoginSpinner);
            
            if (email === 'ebubechichukwu8@gmail.com' && password === 'Ebube@123') {
                isAdmin = true;
                hideLoading(adminLoginButton, adminLoginButtonText, adminLoginSpinner);
                showScreen(adminPanel);
                loadAdminPanel();
            } else {
                hideLoading(adminLoginButton, adminLoginButtonText, adminLoginSpinner);
                alert('Invalid admin credentials!');
            }
        });
        
        // Logout functions
        logoutButton.addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut().then(() => {
                    userBalance = 0;
                    currentUser = null;
                    showScreen(loginScreen);
                });
            }
        });
        
        adminLogoutButton.addEventListener('click', () => {
            if (confirm('Are you sure you want to logout from admin panel?')) {
                isAdmin = false;
                showScreen(loginScreen);
            }
        });
        
        // Load SeaCoin price on startup
        db.collection('settings').doc('seaCoinPrice').get()
            .then(doc => {
                if (doc.exists) {
                    seaCoinPriceValue = doc.data().value;
                    seaCoinPrice.textContent = `$${seaCoinPriceValue.toFixed(2)}`;
                }
            })
            .catch(error => {
                console.error('Error loading SeaCoin price:', error);
            });
        
        // Initialize app
        showScreen(loginScreen);
    </script>
</body>
</html>
